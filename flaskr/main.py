import io
from urllib import response

from flask import (Flask, flash, jsonify, make_response, redirect, request,
                   send_file)

from salsa import Salsa

app = Flask(__name__)
app.secret_key = "secret key"

@app.route("/", methods=['GET'])
def hello_world():

	#Obtains the message and converts it to an int array.
	_message = [22, 45, 121, 33]
	_message2 = [1542887410,460475636,560401146,3567844388]
	s = Salsa()
	salsa20 = s()
	resultado = []
	for i in range(len(_message)):
	# to encrypt ->	
		resultado.append(str(salsa20[i % 16] ^ _message[i]))

	# to decrypt ->
		#resultado.append(str(salsa20[i % 16] ^ _message2[i]))
	response = {'action': 'encrypt',
		'message': resultado}
	return response


@app.route("/encrypt/", methods=['POST'])
def encrypt():
	if request.method == 'POST':
		if 'file' not in request.files:
			flash('No file part')
			return redirect(request.url)
		
		file = request.files['file']
		if file.filename == '':
			flash('No file selected for uploading')
			return redirect(request.url)

		fileBytes = request.files['file'].stream.read()
		print(fileBytes)

		#TODO - Encrypt the image with Salsa20
		result = __salsa_encrypt(fileBytes)

		return send_file(io.BytesIO(bytes(result)), 'image/jpeg')

def __salsa_encrypt(fileBytes):
	bytes_list = list(fileBytes)
	s = Salsa()
	salsa20 = s()
	result = []
	for i in range(len(bytes_list)):
	# to encrypt ->	
		result.append((salsa20[i % 16] ^ bytes_list[i]) % 256)
	
	return result

	

@app.route("/decrypt/", methods=['POST'])
def decrypt():
	#TODO - Receive an image (string encoded in base64?)
	#TODO - Decrypt with Salsa20

	response = {'action': 'decrypt'}
	return send_file()

bocaArray = [0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf3, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xc1, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0xff, 0xff, 
0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x3f, 0xff, 0xf0, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x1f, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf8, 0x00, 0x07, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xf0, 0x00, 0x01, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 
0x3f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x07, 0xf0, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x04, 0x00, 0x01, 0xf0, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfc, 0x00, 0x3f, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xf8, 0x00, 0x1f, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x1e, 
0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x1e, 0x00, 0x00, 0x00, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x01, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x01, 0x00, 0x10, 0x01, 0x00, 
0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x01, 0x80, 0x10, 0x01, 0x00, 0x00, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0x80, 0x0f, 0xc0, 0x38, 0x03, 0x80, 0x10, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xfe, 0x00, 0x03, 0x80, 0x7e, 0x07, 0xe0, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x03, 
0x80, 0x38, 0x03, 0xc0, 0x70, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x04, 0xc0, 0x3c, 0x03, 
0xc0, 0x30, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x44, 0x00, 0x40, 0x30, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x04, 0x00, 0x40, 0x08, 
0x00, 0x80, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x04, 0x00, 0xc0, 0x08, 0x00, 0x80, 0x00, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x3f, 0x87, 0xf8, 0x7f, 0x03, 0xf0, 0x10, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xf0, 0x1f, 0x03, 0xf0, 0x3e, 0x03, 0xe0, 0x70, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
0x0e, 0x01, 0xe0, 0x1c, 0x01, 0xc0, 0x30, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x1e, 0x01, 0xe0, 
0x1e, 0x03, 0x40, 0x30, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x11, 0x01, 0x00, 0x02, 0x02, 0x20, 
0x30, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 
0x08, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x01, 0x00, 0x08, 0x00, 0x80, 
0x04, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x01, 0x80, 0x18, 0x00, 0xc0, 0x0c, 0x00, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xf0, 0x0f, 0xe0, 0x7f, 0x07, 0xf0, 0x3f, 0x80, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xf8, 0x03, 0xc0, 0x3c, 0x01, 0xe0, 0x1e, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x03, 
0xc0, 0x1c, 0x01, 0xe0, 0x1e, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x02, 0xc0, 0x36, 0x01, 
0x60, 0x1a, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x01, 0xff, 0xe0, 0x00, 0x09, 
0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x07, 0xff, 0xf0, 0x00, 0x1f, 0xf0, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfc, 0x00, 0x0f, 0xff, 0xf8, 0x00, 0x1f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xfc, 0x00, 0x1f, 0xff, 0xfc, 0x00, 0x1f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x3f, 
0xff, 0xfe, 0x00, 0x1f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x3f, 0xff, 0xff, 0x00, 
0x1f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x7f, 0xff, 0xff, 0x00, 0x1f, 0xf0, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x3f, 0xc0, 0xff, 0x00, 0x0f, 0xf0, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xfe, 0x00, 0x3f, 0xc0, 0xff, 0x00, 0x0f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 
0x3f, 0xc0, 0xff, 0x00, 0x0f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x3f, 0xc0, 0xff, 
0x00, 0x1f, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x3f, 0xc0, 0xff, 0x00, 0x1f, 0xf0, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x3f, 0xc0, 0x00, 0x00, 0x3f, 0xd0, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0x00, 0x3f, 0xc0, 0x00, 0x00, 0x3f, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0x00, 0x3f, 0xc0, 0x00, 0x00, 0x7f, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x3f, 0xc0, 
0x00, 0x00, 0x7f, 0x80]
